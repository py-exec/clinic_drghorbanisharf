{% extends "base.html" %}
{% load static %}
{% load humanize %}

{% block title %}جزئیات گزارش اکو (TEE) - {{ report.patient.full_name }}{% endblock %}

{% block content %}
<h4 class="py-3 mb-4">
    <span class="text-muted fw-light">گزارش‌ها / اکو TEE /</span> جزئیات گزارش
</h4>

<div class="row">
    <div class="col-lg-8 mx-auto">
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">گزارش اکو از راه مری (TEE)</h5>
                <div>
                    <a href="{% url 'echo_tee:tee_update' report.pk %}" class="btn btn-sm btn-primary me-2">
                        <i class="bx bx-edit-alt me-1"></i> ویرایش
                    </a>
                    <a href="{% url 'echo_tee:tee_list' %}" class="btn btn-sm btn-outline-secondary">
                        <i class="bx bx-arrow-back me-1"></i> بازگشت به لیست
                    </a>
                </div>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>بیمار:</strong>
                        <a href="{% url 'patient:patient_detail' report.patient.pk %}">{{ report.patient.full_name }} (کد ملی: {{ report.patient.national_code|default:"--" }})</a>
                    </div>
                    <div class="col-md-6">
                        <strong>کد پذیرش:</strong>
                        {% if report.reception_service %}
                            <a href="{% url 'reception:service_detail' report.reception_service.pk %}">
                                {{ report.reception_service.reception.admission_code }}
                            </a>
                        {% else %}
                            --
                        {% endif %}
                    </div>
                </div>
                <hr>

                <h6><i class="bx bx-info-circle me-1"></i> اطلاعات عمومی</h6>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>نسخه:</strong> {{ report.prescription.title|default:"--" }}
                    </div>
                    <div class="col-md-6">
                        <strong>تاریخ انجام:</strong> {{ report.exam_datetime|date:"Y/m/d - H:i" }}
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>نوع آرام‌بخش:</strong> {{ report.sedation_used|default:"--" }}
                    </div>
                    <div class="col-md-6">
                        <strong>میزان همکاری بیمار:</strong> {{ report.get_patient_cooperation_display|default:"--" }}
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>کیفیت تصاویر:</strong> {{ report.get_visualization_quality_display|default:"--" }}
                    </div>
                    <div class="col-md-6">
                        <strong>ایجادکننده:</strong> {{ report.created_by.full_name|default:"--" }}
                    </div>
                </div>

                <hr>
                <h6><i class="bx bx-file-text me-1"></i> یافته‌ها</h6>
                <div class="row mb-3">
                    <div class="col-md-12"><strong>وضعیت LAA:</strong> {{ report.la_appendage_status|default:"--" }}</div>
                    <div class="col-md-12"><strong>سپتوم بین دهلیزی:</strong> {{ report.interatrial_septum|default:"--" }}</div>
                    <div class="col-md-12"><strong>مشاهدات دریچه‌ها:</strong> {{ report.valvular_findings|default:"--" }}</div>
                    <div class="col-md-6"><strong>وجود لخته:</strong> {{ report.presence_of_clot|yesno:"بله,خیر" }}</div>
                    <div class="col-md-6"><strong>افیوژن پریکارد:</strong> {{ report.pericardial_effusion|yesno:"بله,خیر" }}</div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-12"><strong>یافته‌های کلی:</strong> <p class="text-break">{{ report.findings|default:"--" }}</p></div>
                </div>

                <hr>
                <h6><i class="bx bx-comment-detail me-1"></i> نظر نهایی و توصیه</h6>
                <div class="row mb-3">
                    <div class="col-md-12"><strong>نظر پزشک:</strong> <p class="text-break">{{ report.doctor_opinion|default:"--" }}</p></div>
                    <div class="col-md-12"><strong>توصیه:</strong> <p class="text-break">{{ report.recommendation|default:"--" }}</p></div>
                </div>
                
                {% if report.echo_file %}
                <hr>
                <h6><i class="bx bx-paperclip me-1"></i> فایل پیوست</h6>
                <div class="row mb-3">
                    <div class="col-md-12">
                        <a href="{{ report.echo_file.url }}" target="_blank" class="btn btn-sm btn-outline-info">
                            <i class="bx bx-download me-1"></i> دانلود فایل TEE
                        </a>
                    </div>
                </div>
                {% endif %}

            </div>
        </div>
    </div>
</div>
{% endblock %}